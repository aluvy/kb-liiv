<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no, viewport-fit=cover"> <!-- 03/07 viewport-fit=cover 추가 -->
    <title>요금제 진단하기</title>
    <script type="text/javascript" src="/ruxitagentjs_ICA27NVdfjqrux_10251220909040818.js" data-dtconfig="rid=RID_-596549055|rpid=-2015510766|domain=liivm.com|reportUrl=/rb_8b5a5eb1-d5db-4a1a-a77d-7d2e82e4daff|app=35bafef188aad98d|rcdec=1209600000|featureHash=ICA27NVdfjqrux|vcv=2|rdnt=1|uxrgce=1|bp=3|srmcrv=10|cuc=5asqbnlw|mel=100000|expw=1|dpvc=1|ssv=4|lastModification=1682040079305|dtVersion=10251220909040818|srmcrl=1|tp=500,50,0,1|uxdcw=1500|agentUri=/ruxitagentjs_ICA27NVdfjqrux_10251220909040818.js"></script><link rel="apple-touch-icon-precomposed" href="/img/apple-touch-icon.png">
    <link rel="icon" href="/img/favicon.ico">
    <link rel="stylesheet" type="text/css" href="/css/style.css">
	<script type="text/javascript" src="/js/lib/jquery-3.3.1.min.js"></script>
	<script type="text/javascript" src="/js/lib/jquery-ui.min.js"></script>
    <script type="text/javascript" src="/js/lib/swiper.min.js"></script>
    <script type="text/javascript" src="/js/front.js"></script>
    <script type="text/javascript" src="/pub/ia_resource/ia.js"></script>
</head>
<body>
    <div class="wrap">
        <!-- header -->
        <div class="header sub"></div>
        <!-- //header -->
        <!-- container -->
        <div class="container">
            <div class="content">
                <h1 class="hidden">요금제 진단하기</h1>
                <h2 class="tit_sub blind">요금제 진단 결과</h2>

                <div class="checkplan_result_wrap">

                    <div class="checkplan_result">
                        <h3 class="checkplan_result_ttl">
                            KB Liiv M 요금제라면<br>
                            연간 <strong>최대 336,000원</strong> 절약!
                        </h3>
                        <div class="checkplan_result_chart">

                            <div class="circle_progress_wrap">
                                <svg class="circle_progress" width="276" height="150" viewBox="0 0 276 150">
                                    <circle class="frame" cx="138" cy="28" r="100" stroke-dashoffset="314.159" stroke-dasharray="628.319"></circle>
                                    <circle class="bar" cx="138" cy="28" r="100" stroke-dashoffset="628.319" stroke-dasharray="628.319"></circle>
                                </svg>
                                <div class="info">
                                    <span class="ttl">
                                        진단점수
                                        <button type="button" id="btn_caution" class="btn_caution"><span class="hidden">진단점수란?</span></button>
                                    </span>
                                    <span class="value"><strong>43</strong>점</span>
                                    <span class="txt">적합한 요금제를 이용하고 계시네요</span>
                                </div>
                            </div>

                        </div><!-- .checkplan_result_chart -->
                    </div><!-- .checkplan_result -->

                    <div class="checkplan_result_partner">
                        <h4 class="tit_item">멤버십 혜택</h4>
                        <!-- [04/20] 멤버십혜택 마크업 수정 :: start -->
                        <div class="partner_area" id="marquee_area">
                            <ul class="partner_wrap marquee-wrap">
                                <li class="partner_item marquee-item">
                                    <span class="slide_ico slide-starbucks">STARBUCKS</span>
                                    <span class="slide_ico slide-cu">CU</span>
                                    <span class="slide_ico slide-tj">TOUS les JOURS</span>
                                    <span class="slide_ico slide-gs25">GS25</span>
                                    <span class="slide_ico slide-kb">KB 국민은행</span>
                                    <span class="slide_ico slide-happycon">Happy Con</span>
                                </li>
                            </ul>
                        </div>
                        <!-- <div class="partner_slide_wrap">
                            <div class="partner_slide swiper">
                                <div class="swiper-wrapper">
                                    <ul class="swiper-slide">
                                        <li><a href="#" class="slide_ico slide-starbucks">STARBUCKS</a></li>
                                        <li><a href="#" class="slide_ico slide-cu">CU</a></li>
                                        <li><a href="#" class="slide_ico slide-tj">TOUS les JOURS</a></li>
                                        <li><a href="#" class="slide_ico slide-gs25">GS25</a></li>
                                        <li><a href="#" class="slide_ico slide-kb">KB 국민은행</a></li>
                                        <li><a href="#" class="slide_ico slide-happycon">Happy Con</a></li>
                                    </ul>
                                </div>
                            </div>
                        </div> -->
                        <!-- [04/20] 멤버십혜택 마크업 수정 :: end -->
                    </div>

                </div><!-- .checkplan_result_wrap -->

                <div class="checkplan_bottom">
                    <div class="head-fix">
                        <button type="button" class="btn_open"><span class="blind">리스트 열기</span></button>
                    </div>
                    <div class="body-scroll">

                        <div class="checkplan_bottom_card_list">
                            <div class="tit_sec_wrap">
                                <h3 class="tit_sec">지금보다 저렴하게!</h3>
                            </div>
                            <div class="card_item line">
                                <a href="#none">
                                    <div class="item_main">
                                        <div class="lt">
                                            <div class="badge_group">
                                                <span class="badge lte">LTE</span>
                                                <span class="badge lg_u">LG U+</span>
                                            </div>
                                            <span class="item_tit">데이터같이쓰기 240분 (안심차단)(LGU+망)</span>
                                        </div>
                                        <div class="rt">
                                            <span class="item_price_sub">기본료 월 29,900원</span>
                                            <span class="item_price">월<strong>24,800원</strong></span>
                                            <span class="item_price_txt">최대할인 적용 시(VAT포함)</span>
                                        </div>
                                    </div>
                                    <div class="info_list">
                                        <ul class="item_info">
                                            <li><i class="icon icon_data"></i><span>월11GB+일2GB+3Mbps</span></li>
                                            <li><i class="icon icon_call"></i><span>기본제공</span></li>
                                            <li><i class="icon icon_msg"></i><span>기본제공</span></li>
                                        </ul>
                                    </div>
                                </a>
                            </div>
                        </div><!-- .checkplan_bottom_card_list -->

                        <div class="checkplan_bottom_card_list">
                            <div class="tit_sec_wrap">
                                <h3 class="tit_sec">지금보다 데이터 더 많이!</h3>
                            </div>
                            <div class="card_item line">
                                <a href="#none">
                                    <div class="item_main">
                                        <div class="lt">
                                            <div class="badge_group">
                                                <span class="badge lte">LTE</span>
                                                <span class="badge kt">KT</span>
                                            </div>
                                            <span class="item_tit">LTE 무제한 11GB+ (KB망)</span>
                                        </div>
                                        <div class="rt">
                                            <span class="item_price_sub">기본료 월 29,900원</span>
                                            <span class="item_price">월<strong>24,800원</strong></span>
                                            <span class="item_price_txt">최대할인 적용 시(VAT포함)</span>
                                        </div>
                                    </div>
                                    <div class="info_list">
                                        <ul class="item_info">
                                            <li><i class="icon icon_data"></i><span>월11GB(10GB+1GB)+일2GB+3Mbps</span></li>
                                            <li><i class="icon icon_call"></i><span>기본제공</span></li>
                                            <li><i class="icon icon_msg"></i><span>기본제공</span></li>
                                        </ul>
                                    </div>
                                </a>
                            </div>
                        </div><!-- .checkplan_bottom_card_list -->

                        <div class="checkplan_bottom_card_list">
                            <div class="tit_sec_wrap">
                                <h3 class="tit_sec">5G 요금제 추천!</h3>
                            </div>
                            <div class="card_item line">
                                <a href="#none">
                                    <div class="item_main">
                                        <div class="lt">
                                            <div class="badge_group">
                                                <span class="badge five_g">5G</span>
                                                <span class="badge skt">SKT</span>
                                            </div>
                                            <span class="item_tit">5G 든든무제한 12GB+</span>
                                        </div>
                                        <div class="rt">
                                            <span class="item_price_sub">기본료 월 29,900원</span>
                                            <span class="item_price">월<strong>24,800원</strong></span>
                                            <span class="item_price_txt">최대할인 적용 시(VAT포함)</span>
                                        </div>
                                    </div>
                                    <div class="info_list">
                                        <ul class="item_info">
                                            <li><i class="icon icon_data"></i><span>12GB+1Mbps</span></li>
                                            <li><i class="icon icon_call"></i><span>기본제공</span></li>
                                            <li><i class="icon icon_msg"></i><span>기본제공</span></li>
                                        </ul>
                                    </div>
                                </a>
                            </div>
                        </div><!-- .checkplan_bottom_card_list -->

                        <div class="btn_wrap mgt20">
                            <button type="button" class="btn primary lg">더 많은 요금제 둘러보기</button>
                        </div>
                    </div>

                </div><!-- .checkplan_bottom -->

            </div>
        </div>
        <!-- //container -->
    </div>

<div id="caution" class="layerHTML">
    <div class="ly_cnt ly_alert">
        <div class="section">
            더 유리하게 이용할 수 있는 KB Liiv M 요금제를 기준으로 응답해주신 통신료와 데이터량을 비교하여 산출한 점수에요.
        </div>
    </div>
    <div class="btn_pop_confirm_wrap">
        <div class="btn_area">
            <button type="button" class="btn primary" data-action="close">확인</button>
        </div>
    </div>
</div>


<script src="/js/lib/hammer.min.js"></script>
<script>
    let mapBottomFix = { type: 0 }; // 0:close , 1:open

    $(()=>{
        $(document).find(".content").css({"padding-bottom": "0"});
        _progress.init();

        setBottomLayout(mapBottomFix.type);

        // [04/20] marquee 호출문 추가
        $.marquee({
            content:'#marquee_area',
        });
    });
    
    // resize, orientationchange
    $(window).on("resize orientationchange", function(e){
        setBottomLayout(mapBottomFix.type);
        // [04/20] swiper 제거
        // partnerSlide.autoplay.stop();
        // partnerSlide.autoplay.start();
    });


    let _HammerWheelEvent = {
        useWheelClose : false,
        wheelCloseNum : 0,
        wheelCloseActive : 3,   // [03/15] _HammerWheelEvent 변수값 수정
    }

    // mousewheel [03/15] mousewheel 이벤트 수정
    $(document).find(".checkplan_bottom .body-scroll").off("mousewheel").on("mousewheel", function(e){

        if( _HammerWheelEvent.useWheelClose ){
            e.preventDefault();
            e.stopPropagation();
        }

        let delta = e.originalEvent.wheelDelta; // 내릴때 -값
        let bottom = $(document).find(".checkplan_bottom");
        let bottom_body = $(document).find(".body-scroll");
        let scroll = bottom.find(".body-scroll").scrollTop();
        let scrollH = bottom.find(".body-scroll").prop("scrollHeight");
        let bodyH = bottom.find(".body-scroll").outerHeight(true);
        let cntScroll = scrollH - bodyH;

        if( !bottom.hasClass("on") && delta > 0 ){  // 올릴때 +값
            setBottomLayout(mapBottomFix.type=1);
            return;
        }

        // console.log( ( bodyH < scrollH ), bodyH, scrollH,  'scroll', scroll, cntScroll, _HammerWheelEvent.useWheelClose, _HammerWheelEvent.wheelCloseNum, _HammerWheelEvent.wheelCloseActive );
        // ( bodyH < scrollH ) ? _HammerWheelEvent.useWheelClose = true : null;    // 스크롤이 없을 때

        if( bottom.hasClass("on") && (scroll >= cntScroll) && delta < 0 ){    // 내릴때 -값
            _HammerWheelEvent.useWheelClose = true;
            _HammerWheelEvent.wheelCloseNum++;

            if( _HammerWheelEvent.wheelCloseNum >= _HammerWheelEvent.wheelCloseActive && delta >= -120 ){
                _HammerWheelEvent.useWheelClose = false;
                _HammerWheelEvent.wheelCloseNum = 0;
                bottom_body.scrollTop(0);
                setBottomLayout(mapBottomFix.type=0);
            }
        } else {
            _HammerWheelEvent.wheelCloseNum = 0;
            _HammerWheelEvent.useWheelClose = false;
        }
    })

    // scroll event [03/15] 스크롤 이벤트 제거
    // $(document).find(".checkplan_bottom .body-scroll").on("scroll", function(e){

    //     let scroll = $(e.target).scrollTop();
    //     let scrollH = $(e.target).prop("scrollHeight");
    //     let bodyH = $(e.target).outerHeight(true);
    //     let cntScroll = scrollH - bodyH;
    //     // console.log( 'body-scroll 화면길이', bodyH, '스크롤값', scroll, cntScroll, scrollH  );

    //     let bottom = $(document).find(".checkplan_bottom");
    //     if( !bottom.hasClass("on") ){
    //         setBottomLayout(mapBottomFix.type=1);
    //     } else {
    //         _HammerWheelEvent.useWheelClose = ( scroll >= cntScroll || cntScroll < 0 ) ? true : false;
    //         ( bodyH < scrollH ) ? _HammerWheelEvent.useWheelClose = true : null;    // 스크롤이 없을 때
    //     }

    //     ( scroll <= 0 ) ? _HammerWheelEvent.useWheelClose = true : null;    // [03/14] test
    // });


    // 멤버십 혜택 swiper   [04/20] swiper 제거
    // var partnerSlide = new Swiper(".partner_slide", {
    //     autoplay: {
    //         delay: 0,
    //         stopOnLastSlide: false,
    //         disabledOnInteraction: false, 
    //     },
    //     speed: 8000,
    //     loop: true,
    //     slidesPerView: "auto",
    //     observer: true,
    //     observerParents: true,
    //     paginationClickable: true,
    //     allowTouchMove: false,
    // });

    // 진단점수 팝업
    $(document).on("click", "#btn_caution", ()=>{
        $.ohyLayer({
            title: "진단점수",
            content: '#caution',
            type: 'confirm',
            closeUse: false,
        });
    })

    // progress
    let _progress = {
            
        data: 43,   // data

        frame: $(document).find(".circle_progress_wrap .frame"),
        bar: $(document).find(".circle_progress_wrap .bar"),
        value: $(document).find(".circle_progress_wrap .value"),
        RADIUS: document.querySelector(".circle_progress_wrap .frame").getAttribute("r"),   // 100
        init: function(){

            let gauge = _progress.gauge(100);                           // 반원
            let dasyarray = _progress.dashArray();
            let dashoffset = dasyarray * (1-gauge);
            
            // frame
            _progress.frame.css({ "stroke-dashoffset" : dashoffset });
            _progress.frame.css({ "stroke-dasharray" : dasyarray });

            // bar
            _progress.bar.css({ "stroke-dasharray" : dasyarray });

            _progress.setData(_progress.data);
        },
        gauge: function(per){
            return per / 200;                   // 반원 (0.5)
        },
        dashArray: function(){                  //  점선 (고정값)
            return 2 * Math.PI * this.RADIUS;
        },
        dashOffset: function(per){              // 시작점 (animation)
            // let progress = per / 200;
            let gauge = _progress.gauge(per);
            let dashoffset = _progress.dashArray() * (1-gauge);

            return dashoffset;
        },
        title: function(per){
            let title = '';
            if ( per < 100 ){
                title = `KB Liiv M 요금제라면<br>연간 <strong>최대 336,000원</strong> 절약!`;
            } else {
                title = `KB Liiv M에서 다양한<br>통신요금을 경험해보세요`;
            }
            return title;
        },
        discription: function(per){
            let text = '';
            if( per <= 40 ){            text = "요금제 변경이 꼭 필요해요";
            } else if ( per <= 60 ){    text = "요금제 변경이 필요해요";
            } else if ( per <= 80 ) {   text = "더 나은 최적의 요금제를 찾았어요";
            } else {                    text = "적합한 요금제를 이용하고 계시네요";
            }
            return text;
        },
        setData: function(per){

            let gauge = _progress.gauge(per);   // 반원
            let dasyarray = _progress.dashArray();
            let dashoffset = dasyarray * (1-gauge);

            _progress.bar.css({ "stroke-dashoffset" : dashoffset });

            // title setting
            let title = _progress.title(_progress.data);
            $(document).find(".checkplan_result .checkplan_result_ttl").html(title);

            // data setting
            $(document).find(".circle_progress_wrap .value strong").html(_progress.data);

            // discription setting
            let text = _progress.discription(_progress.data);
            $(document).find(".circle_progress_wrap .info .txt").html(text);
        }
    }

    const setBottomLayout = function(type){
        // 0:close , 1:open

        btmOpen(type);

        const winH = $(window).height();
        const winW = $(window).width();
        const headH = $(document).find(".header .inner_sub").height();
        
        const wrap = $(document).find(".checkplan_result_wrap");
        const wrapH = wrap.height();
        const resultH = $(document).find(".checkplan_result_wrap .checkplan_result").height();

        const minH = 0;             // 열린상태 bottom 값
        let maxH =  winH - 170;     // 닫힌상태 bottom 값

        if(  winH <= (wrapH + headH) ){
            maxH = winH - 170;
            if( winW <= 280 ){          maxH = winH - 140;
            } else if( winW <= 320 ) {   maxH = winH - 150;
            }
        } else {
            maxH = winH - (winH + 60 - wrapH) - 50;
            if( winW <= 280 ){          maxH = winH - (winH + 60 - wrapH) - 30;
            } else if( winW <= 320 ) {   maxH = winH - (winH + 60 - wrapH) - 30;
            }
        }

        const btm = ( type == 1 ) ? minH : -maxH;

        const bottom = $(document).find(".checkplan_bottom");
        const content = $(document).find(".checkplan_bottom .body-scroll");
        const btn = $(document).find(".checkplan_bottom .head-fix .blind");

        bottom.css({"bottom" : `${btm}px`});
        // bottom.find(".body-scroll").scrollTop(0);

        ( type == 1 ) ? bottom.addClass("on") : bottom.removeClass("on");
        ( type == 1 ) ? wrap.addClass("blur") :  wrap.removeClass("blur");
        ( type == 1 ) ? btn.text("리스트 닫기") : btn.text("리스트 열기");
        
        setH(type, btm);
    }

    const setH = function(type, btm){
        // 0:close, 1:open
        btm = Math.abs(btm);

        const winH = $(window).height();
        const headH = $(document).find(".header .inner_sub").outerHeight(true); // [03/15] set() 내 headH 값 수정
        const headFixH = $(document).find(".checkplan_bottom .head-fix").outerHeight(true);

        const bottom = $(document).find(".checkplan_bottom");
        const content = $(document).find(".checkplan_bottom .body-scroll");
        
        const btmH = (winH - headH);
        const contH = Math.round(winH - headH - headFixH - btm);

        bottom.css({"height": `${btmH}px`});
        content.css({"height": `${contH}px`});
    }

    const btmOpen = function(type){
        // 0:close, 1:open

        let wrap = $(document).find(".wrap");
        let $win = $(window);

        if(type == 0){
            // close
            let $scrollTop = parseInt(wrap.css("top"))*-1;
            $("html, body").removeClass("noScroll");
            
            wrap.css({
                "top": "",
                "position" : ""
            });
            $win.scrollTop($scrollTop);

        } else {
            // open
            var $scrollTop = $(window).scrollTop();

            setTimeout(function(){
                wrap.css({
                    "top":-$scrollTop,
                    "position" : "relative"
                });
                $("html, body").addClass("noScroll");
            },0);
        }
    }

    // hammer
    $(()=>{
        var wrap = new Hammer(document.querySelector(".checkplan_bottom"));
        wrap.get('pan').set({direction: Hammer.DIRECTION_VERTICAL});    // [03/10] Hammer Event 수정
        wrap.off("panup pandown").on("panup pandown", function(e){

            const bottom = $(document).find(".checkplan_bottom");
            const type = e.type;
            const contentScrollTop = $(document).find(".checkplan_bottom .body-scroll").scrollTop();   // pandown 시 scroll check

            if( type == 'panup' ){
                setBottomLayout(mapBottomFix.type=1);
            } else if ( type == 'pandown' ) {
                if( contentScrollTop > 0 ) return;
                // console.log('pandown', contentScrollTop );
                setBottomLayout(mapBottomFix.type=0);
            }
        })

        let elem = document.querySelector(".checkplan_bottom .btn_open");
        let mc = new Hammer(elem);
        mc.off("tap").on("tap", function(e){

            const bottom = $(document).find(".checkplan_bottom");
            mapBottomFix.type = ( bottom.hasClass("on") ) ? 0 : 1;
            setBottomLayout(mapBottomFix.type);
        })
    });

</script>
</body>
</html>